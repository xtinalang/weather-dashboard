{% extends "base.html" %}

{% block title %}Weather for {{ weather.location.name }}{% endblock %}

{% block content %}
<!-- Flash Messages -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <div class="flash-messages">
            {% for category, message in messages %}
                <div class="flash-message {{ category }}">{{ message }}</div>
            {% endfor %}
        </div>
    {% endif %}
{% endwith %}

<div class="weather-display">
    <h2>Weather for {{ weather.location.name }}</h2>
    <p>{{ weather.location.region }}, {{ weather.location.country }}</p>
    <p>Last updated: {{ weather.current.last_updated }}</p>

    <div class="card">
        {% if weather.current.icon %}
        <div class="weather-icon">
            <img src="{{ weather.current.icon }}" alt="{{ weather.current.condition }}">
        </div>
        {% endif %}

        <div class="condition">{{ weather.current.condition }}</div>

        <div class="temperature">
            {{ weather.current.temp }}°{{ weather.unit }}
        </div>

        <div>Feels like: {{ weather.current.feelslike }}°{{ weather.unit }}</div>
    </div>

    <div class="weather-details">
        <p><strong>Humidity:</strong> {{ weather.current.humidity }}%</p>
        <p><strong>Wind:</strong> {{ weather.current.wind_kph }} km/h {{ weather.current.wind_dir }}</p>
        <p><strong>Pressure:</strong> {{ weather.current.pressure_mb }} mb</p>
        <p><strong>Precipitation:</strong> {{ weather.current.precip_mm }} mm</p>
    </div>
</div>

<div class="nav">
    <a href="{{ url_for('index') }}">Back to Home</a>
    <a href="{{ url_for('weather', lat=lat, lon=lon, unit='C' if weather.unit == 'F' else 'F') }}">
        Switch to °{{ 'C' if weather.unit == 'F' else 'F' }}
    </a>

    <form action="{{ url_for('toggle_favorite', location_id=location.id, next=request.path) }}" method="post" style="display: inline-block; margin-top: 10px;">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="btn">
            {% if location.is_favorite %}
            ★ Remove from Favorites
            {% else %}
            ☆ Add to Favorites
            {% endif %}
        </button>
    </form>
</div>
{% endblock %}
